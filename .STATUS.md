# gRPC Debugger ç‹€æ…‹å ±å‘Š (v1.0.0)

## ğŸ“Œ å°ˆæ¡ˆæ¦‚æ³
æœ¬å°ˆæ¡ˆå·²å®Œæˆå¾ React åˆ° **Svelte 5 (Runes)** çš„å…¨æ–°æ¶æ§‹é·ç§»ã€‚ç›®å‰å°ˆæ¡ˆè™•æ–¼ç©©å®šç‹€æ…‹ï¼Œæ”¯æ´ **gRPC-Web** èˆ‡ **Connect-RPC** çš„è‡ªå‹•åµæ¸¬èˆ‡è§£ç¢¼ã€‚

## ğŸ› ï¸ æŠ€è¡“æ£§
- **Frontend**: Svelte 5 (Runes æ¨¡å¼)
- **Build Tool**: Vite + ESM Standard
- **Decoding Engine**: è‡ªç ” `ProtoEngine.js` (Schema-Driven)
- **Communication**: Manifest V3 + Chrome Debugger API

## âœ… å·²å®ŒæˆåŠŸèƒ½
- [x] **è‡ªå‹• Reflection**: åµæ¸¬åˆ°æ–°ä¼ºæœå™¨æ™‚ï¼ŒèƒŒæ™¯æœƒè‡ªå‹•å˜—è©¦ç²å–å®šç¾©ã€‚
- [x] **å®šç¾©é©…å‹•è§£ç¢¼**: å„ªå…ˆä½¿ç”¨ Protobuf å®šç¾©é‚„åŸæ¬„ä½åç¨±èˆ‡å·¢ç‹€çµæ§‹ã€‚
- [x] **ç›²æ¸¬è§£ç¢¼ (Blind Decoding)**: åœ¨ç¼ºå®šç¾©çš„æƒ…æ³ä¸‹ï¼Œé€éå•Ÿç™¼å¼æ¼”ç®—æ³•é‚„åŸæ•¸æ“šå±¤ç´šã€‚
- [x] **å¤šé é¢å°èˆª**: ç¶²è·¯ç´€éŒ„ (Network)ã€æœå‹™å®šç¾© (Services)ã€è¨­å®š (Settings) é é¢ã€‚
- [x] **å®Œæ•´åœ‹éš›åŒ– (i18n)**: æ”¯æ´ ç¹é«”ä¸­æ–‡ (zh) èˆ‡ è‹±æ–‡ (en)ã€‚
- [x] **èˆŠç¨‹å¼ç¢¼æ¸…ç†**: å·²æ¸…é™¤æ‰€æœ‰èˆŠç‰ˆ React æª”æ¡ˆã€‚

## âœ… æœ€è¿‘ä¿®å¾© (Last Commit)
1. **é‡æ§‹è§£æå¼•æ“**: `ProtoReader` å…¨é¢æ”¹ç”¨ `BigInt` èˆ‡ `DataView`ï¼Œå¾¹åº•æ¶ˆé™¤ 32 ä½å…ƒæº¢å‡ºã€‚
2. **å‚³è¼¸å±¤é€æ˜åŒ–**: æ”¯æ´ `gzip` è‡ªå‹•è§£å£“ç¸®èˆ‡ Connect-RPC å½±æ ¼å°é½Šï¼ˆéæ¿¾ EOS å½±æ ¼ï¼‰ã€‚
3. **åå°„å®šç¾©åŠ å¼·**: è£œå…¨ Enum å®šç¾©è§£æèˆ‡ Nested Types å®Œæ•´è·¯å¾‘æ ¡æ­£ã€‚

---

## ğŸ“‹ å¾…è™•ç†é‡æ§‹é …ç›® (2025/12/22 Code Review)

### ğŸ”´ é«˜å„ªå…ˆç´š (High Priority)

#### 1. `ProtoReader` æ–¹æ³•é‡è¤‡å®šç¾©
- **æª”æ¡ˆ**: `src/lib/proto-engine.js` (Lines 263-266} 318-323)
- **å•é¡Œ**: `readSVarint()` å’Œ `readSVarint64()` å„è¢«å®šç¾©äº†å…©æ¬¡ï¼Œå¾Œè€…è¦†è“‹å‰è€…
- **å½±éŸ¿**: ç¨‹å¼ç¢¼å†—é¤˜ã€ç¶­è­·æ··äº‚
- **ä¿®å¾©**: åˆªé™¤é‡è¤‡çš„æ–¹æ³•å®šç¾© (Lines 318-330)

#### 2. Store å–å€¼æ–¹å¼ä¸ç•¶ (Potential Memory Leak)
- **æª”æ¡ˆ**: `src/stores/network.js` (Lines 54, 81-85)
- **å•é¡Œ**: ä½¿ç”¨ `subscribe(() => {})()` çš„ hacky æ¨¡å¼ä¾†åŒæ­¥å–å€¼
- **å½±éŸ¿**: å¯è®€æ€§å·®ã€å®¹æ˜“é€ æˆ memory leak
- **ä¿®å¾©**: æ”¹ç”¨ `import { get } from 'svelte/store'` ä¾†åŒæ­¥å–å€¼

#### 3. `reflectedServers` ééŸ¿æ‡‰å¼
- **æª”æ¡ˆ**: `src/stores/schema.js` (Line 7)
- **å•é¡Œ**: ä½¿ç”¨æ™®é€š `Set` è€Œé Svelte Storeï¼Œè‹¥ UI ä¾è³´æ­¤ç‹€æ…‹æœƒä¸åŒæ­¥
- **å½±éŸ¿**: æ½›åœ¨çš„ UI ç‹€æ…‹ä¸ä¸€è‡´
- **ä¿®å¾©**: å¦‚éœ€éŸ¿æ‡‰å¼ï¼Œæ”¹ç”¨ `writable(new Set())` æˆ–ç¢ºèªç„¡ UI ä¾è³´å‰‡ä¿æŒç¾ç‹€

---

### ğŸŸ  ä¸­å„ªå…ˆç´š (Medium Priority)

#### 4. Magic Numbers æ•£è½å„è™•
- **æª”æ¡ˆ**: `src/lib/proto-engine.js` (Lines 141, 149, 205-208, 212-236)
- **å•é¡Œ**: Protobuf Field Types ç›´æ¥å¯«æ­»æ•¸å­— (å¦‚ `11`, `14`, `18`)
- **ä¿®å¾©**: æŠ½å–ç‚ºå¸¸æ•¸ç‰©ä»¶ `FieldType = { DOUBLE: 1, MESSAGE: 11, ... }`

#### 5. `reflection-client.js` éæ–¼é¾å¤§ (740 Lines)
- **æª”æ¡ˆ**: `src/lib/reflection-client.js`
- **å•é¡Œ**: æ··åˆäº† gRPC-Web è«‹æ±‚ã€Protobuf è§£æã€å¤šç¨® parse æ–¹æ³•
- **ä¿®å¾©**: æ‹†åˆ†ç‚ºç¨ç«‹æ¨¡çµ„
  - `grpc-web-transport.js`: HTTP è«‹æ±‚èˆ‡ framing
  - `protobuf-parser.js`: Descriptor è§£æ

#### 6. ç¼ºå°‘ `onDestroy` æ¸…ç†
- **æª”æ¡ˆ**: `src/App.svelte` (Lines 17-31)
- **å•é¡Œ**: `chrome.tabs.onUpdated.addListener` è¨»å†Šå¾Œæœªåœ¨ unmount æ™‚ç§»é™¤
- **ä¿®å¾©**: åŠ å…¥ `onDestroy` ä¸¦èª¿ç”¨ `removeListener`

#### 7. ç„¡çµ±ä¸€ Logger æ©Ÿåˆ¶
- **æª”æ¡ˆ**: å¤šè™• (`proto-engine.js`, `network.js`, `schema.js`, `reflection-client.js`)
- **å•é¡Œ**: å¤§é‡ `console.debug` / `console.warn`ï¼Œæ­£å¼ç™¼å¸ƒæœƒæ±¡æŸ“ä½¿ç”¨è€… console
- **ä¿®å¾©**: å»ºç«‹ `src/lib/logger.js`ï¼Œå¯ä¾ç’°å¢ƒé–‹é—œ

---

### ğŸŸ¡ ä½å„ªå…ˆç´š (Low Priority)

#### 8. `JsonTree.svelte` æœªè™•ç†ç‰¹æ®Šé¡å‹
- **æª”æ¡ˆ**: `src/components/JsonTree.svelte` (Line 44)
- **å•é¡Œ**: `Uint8Array` å’Œ `BigInt` æœƒé¡¯ç¤ºéŒ¯èª¤æˆ– `[object Uint8Array]`
- **ä¿®å¾©**: åŠ å…¥ `formatValue()` å‡½å¼è™•ç†ç‰¹æ®Šé¡å‹

#### 9. `background.js` ç„¡ TypeScript ä¿è­·
- **æª”æ¡ˆ**: `public/background.js`
- **å•é¡Œ**: è™•ç† Chrome Debugger API çš„è¤‡é›œé‚è¼¯ï¼Œç¼ºä¹å‹åˆ¥æª¢æŸ¥
- **ä¿®å¾©**: è€ƒæ…®é·ç§»è‡³ TypeScript æˆ–åŠ å…¥ JSDoc è¨»è§£

#### 10. CSS è®Šæ•¸æœªæŠ½å–ç‚ºå…±ç”¨
- **æª”æ¡ˆ**: å¤šå€‹ `.svelte` å…ƒä»¶
- **å•é¡Œ**: é‡è¤‡ä½¿ç”¨ `#2563eb`, `#e5e7eb`, `#f3f4f6` ç­‰é¡è‰²
- **ä¿®å¾©**: åœ¨ `App.svelte` çš„ `:global` ä¸­å®šç¾© CSS Variables

---

*æ›´æ–°æ—¥æœŸï¼š2025/12/22 09:33*
*ç‹€æ…‹ï¼šé‡æ§‹å®Œæˆï¼ˆ8/10 é …ï¼‰ï¼Œ2 é …å»¶å¾Œè™•ç†*
